{"title":"重构技巧之添加参数","slug":"Add_Parameter_in_Refactoring","date":"2019-03-10T01:32:02.000Z","updated":"2023-09-08T06:12:36.540Z","comments":true,"path":"api/articles/Add_Parameter_in_Refactoring.json","excerpt":null,"covers":null,"content":"<h1 id=\"序\"><a href=\"#序\" class=\"headerlink\" title=\"序\"></a>序</h1><p>最近在经手一个Winform项目,里面有个需求：TreeView控件选择不同的TreeNode时，需要展示不同的右键菜单。记录一下重构过程。</p>\n<h2 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h2><p>现将公司内部需求初始需求转换如下：<br>如果TreeView选中的TreeNode是国家，则右键菜单展示”添加省”,一个选项。<br>如果TreeView选中的TreeNode是省份，则右键菜单展示”添加市”，”删除”两个选项。<br>如果TreeView选中的TreeNode是城市，则右键菜单展示”添加区”，”删除”两个选项。<br>如果TreeView选中的TreeNode是区，则右键菜单展示，”删除”一个选项。<br>这部分的伪代码如下：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var<span class=\"built_in\"> area </span>= TreeView.SelectedNode.Tag as<span class=\"built_in\"> Area; </span>//</span><br><span class=\"line\"><span class=\"keyword\">if</span>(area!=<span class=\"literal\">null</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    var <span class=\"attribute\">areaType</span>=area.type;</span><br><span class=\"line\">    ContextMenuStrip menuStrip = new ContextMenuStrip();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.国家)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加省&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.省份)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加市&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.城市)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加区&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.区)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    menuStrip.Show(e.Location);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>后来业务发展了,除了AreaType.国家这个选项，右键菜单都需要添加一个”打开地图”的右键菜单，且位于右键菜单的最上方。<br>重构之后的示例代码变成了如下：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var<span class=\"built_in\"> area </span>= TreeView.SelectedNode.Tag as<span class=\"built_in\"> Area; </span>//</span><br><span class=\"line\"><span class=\"keyword\">if</span>(area!=<span class=\"literal\">null</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    var <span class=\"attribute\">areaType</span>=area.type;</span><br><span class=\"line\">    ContextMenuStrip menuStrip = new ContextMenuStrip();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.国家)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加省&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.省份)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加市&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.城市)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加区&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.区)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    menuStrip.Show(e.Location);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这次需求变动，已经让我闻到了代码中的坏味道。增删改一个右键菜单需要修改好几处地方，删除右键菜单也是同理。<br>故需要对代码进行重构。</p>\n<h2 id=\"重构\"><a href=\"#重构\" class=\"headerlink\" title=\"重构\"></a>重构</h2><p>提取函数，伪代码如下</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> ContextMenuStrip menuStrip = <span class=\"keyword\">new</span> <span class=\"constructor\">ContextMenuStrip()</span>; <span class=\"comment\">//菜单转为私有属性</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> void <span class=\"constructor\">AddToolStripMenuItem(<span class=\"params\">string</span> <span class=\"params\">controlName</span>, <span class=\"params\">bool</span> <span class=\"params\">isAdd</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isAdd)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        this.menuStrip.Items.<span class=\"constructor\">Add(<span class=\"params\">new</span> ToolStripMenuItem(<span class=\"params\">controlName</span>)</span>;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>故调用处的实现代码变成了如下</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var area = TreeView.SelectedNode.Tag <span class=\"keyword\">as</span> Area; <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(area!=null)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    var areaType=area.<span class=\"keyword\">type</span>;</span><br><span class=\"line\">    this.menuStrip.Items.<span class=\"constructor\">Clear()</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;添加省&quot;</span>,<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.国家)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>,!<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.国家)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;添加市&quot;</span>,<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.省份)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;添加区&quot;</span>,<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.城市)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>,!<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.国家)</span>;</span><br><span class=\"line\">    menuStrip.<span class=\"constructor\">Show(<span class=\"params\">e</span>.Location)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>若以后需求变更,<strong>打开地图</strong>需要改成<strong>打开百度地图</strong>，然后新增<strong>打开高德地图</strong>也只需要修改一行代码，并新增一行代码即可。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>该重构过程运用的是提取函数和函数添加参数。<br><strong>AddToolStripMenuItem函数</strong>只关心菜单项是否添加，而不关心菜单项添加的逻辑是什么。<br>重构之后，右键菜单的可能的菜单项也一目了然，每一个菜单项对应的添加条件也一目了然。若<strong>isAdd</strong>参数对应的表达式过长，则可以将该表达式封装成函数进行传递。<br>通过该重构提高了项目的可维护性，也算是一种成就。</p>\n","more":"<h1 id=\"序\"><a href=\"#序\" class=\"headerlink\" title=\"序\"></a>序</h1><p>最近在经手一个Winform项目,里面有个需求：TreeView控件选择不同的TreeNode时，需要展示不同的右键菜单。记录一下重构过程。</p>\n<h2 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h2><p>现将公司内部需求初始需求转换如下：<br>如果TreeView选中的TreeNode是国家，则右键菜单展示”添加省”,一个选项。<br>如果TreeView选中的TreeNode是省份，则右键菜单展示”添加市”，”删除”两个选项。<br>如果TreeView选中的TreeNode是城市，则右键菜单展示”添加区”，”删除”两个选项。<br>如果TreeView选中的TreeNode是区，则右键菜单展示，”删除”一个选项。<br>这部分的伪代码如下：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var<span class=\"built_in\"> area </span>= TreeView.SelectedNode.Tag as<span class=\"built_in\"> Area; </span>//</span><br><span class=\"line\"><span class=\"keyword\">if</span>(area!=<span class=\"literal\">null</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    var <span class=\"attribute\">areaType</span>=area.type;</span><br><span class=\"line\">    ContextMenuStrip menuStrip = new ContextMenuStrip();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.国家)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加省&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.省份)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加市&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.城市)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加区&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.区)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    menuStrip.Show(e.Location);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>后来业务发展了,除了AreaType.国家这个选项，右键菜单都需要添加一个”打开地图”的右键菜单，且位于右键菜单的最上方。<br>重构之后的示例代码变成了如下：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var<span class=\"built_in\"> area </span>= TreeView.SelectedNode.Tag as<span class=\"built_in\"> Area; </span>//</span><br><span class=\"line\"><span class=\"keyword\">if</span>(area!=<span class=\"literal\">null</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    var <span class=\"attribute\">areaType</span>=area.type;</span><br><span class=\"line\">    ContextMenuStrip menuStrip = new ContextMenuStrip();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.国家)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加省&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.省份)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加市&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.城市)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;添加区&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"attribute\">areaType</span>==AreaType.区)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>));</span><br><span class=\"line\">        menuStrip.Items.<span class=\"built_in\">Add</span>(new ToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    menuStrip.Show(e.Location);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这次需求变动，已经让我闻到了代码中的坏味道。增删改一个右键菜单需要修改好几处地方，删除右键菜单也是同理。<br>故需要对代码进行重构。</p>\n<h2 id=\"重构\"><a href=\"#重构\" class=\"headerlink\" title=\"重构\"></a>重构</h2><p>提取函数，伪代码如下</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> ContextMenuStrip menuStrip = <span class=\"keyword\">new</span> <span class=\"constructor\">ContextMenuStrip()</span>; <span class=\"comment\">//菜单转为私有属性</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> void <span class=\"constructor\">AddToolStripMenuItem(<span class=\"params\">string</span> <span class=\"params\">controlName</span>, <span class=\"params\">bool</span> <span class=\"params\">isAdd</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isAdd)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        this.menuStrip.Items.<span class=\"constructor\">Add(<span class=\"params\">new</span> ToolStripMenuItem(<span class=\"params\">controlName</span>)</span>;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>故调用处的实现代码变成了如下</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var area = TreeView.SelectedNode.Tag <span class=\"keyword\">as</span> Area; <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(area!=null)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    var areaType=area.<span class=\"keyword\">type</span>;</span><br><span class=\"line\">    this.menuStrip.Items.<span class=\"constructor\">Clear()</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;添加省&quot;</span>,<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.国家)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;打开地图&quot;</span>,!<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.国家)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;添加市&quot;</span>,<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.省份)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;添加区&quot;</span>,<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.城市)</span>;</span><br><span class=\"line\">    <span class=\"constructor\">AddToolStripMenuItem(<span class=\"string\">&quot;删除&quot;</span>,!<span class=\"params\">areaType</span><span class=\"operator\">==</span>AreaType.国家)</span>;</span><br><span class=\"line\">    menuStrip.<span class=\"constructor\">Show(<span class=\"params\">e</span>.Location)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>若以后需求变更,<strong>打开地图</strong>需要改成<strong>打开百度地图</strong>，然后新增<strong>打开高德地图</strong>也只需要修改一行代码，并新增一行代码即可。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>该重构过程运用的是提取函数和函数添加参数。<br><strong>AddToolStripMenuItem函数</strong>只关心菜单项是否添加，而不关心菜单项添加的逻辑是什么。<br>重构之后，右键菜单的可能的菜单项也一目了然，每一个菜单项对应的添加条件也一目了然。若<strong>isAdd</strong>参数对应的表达式过长，则可以将该表达式封装成函数进行传递。<br>通过该重构提高了项目的可维护性，也算是一种成就。</p>\n","categories":[{"name":"代码世界","path":"api/categories/代码世界.json"},{"name":"重构","path":"api/categories/重构.json"}],"tags":[{"name":"重构","path":"api/tags/重构.json"},{"name":"TreeView","path":"api/tags/TreeView.json"}]}